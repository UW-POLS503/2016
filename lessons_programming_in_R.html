<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Programming in R</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>
<link rel="stylesheet" href="pols503.css"/>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>




</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {
    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: "h1.title, .toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button"
              class="navbar-toggle collapsed"
              data-toggle="collapse"
              data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://UW-POLS503.github.io/pols_503_sp16">POLS/CS&amp;SS 503</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="schedule.html">Schedule</a></li>
        <li><a href="https://uw-pols503.github.io/pols503-notes/">Notes</a></li>
        <!-- start assignments dropdown -->
        <li class="dropdown">
          <a href="assignments" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Assignments <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <!-- ADD NEW ASSIGNMENTS HERE -->
            <li class="dropdown-header">Assignments</li>
            <li><a href="https://github.com/UW-POLS503/Assignment_01">Assignment 1</a></li>
            <li class="divider"></li>
            <li class="dropdown-header">Project</li>
            <li><a href="assignments_project_1.html">Project Assignment 1</a></li>
            <li><a href="assignments_project_2.html">Project Assignment 2</a></li>
            <li><a href="assignments_project_3.html">Project Assignment 3</a></li>
            <li><a href="data_analysis_project_paper_guidelines.html">Final Project</a></li>
             <li class="divider"></li>
            <li class="dropdown-header">Peer Review</li>
            <li><a href="assignments_peer_review_1.html">Peer Review 1</a></li>
          </ul>
        </li>
        <!-- end assignments dropdown -->
        <!-- start lessons dropdown -->
        <li class="dropdown">
          <a href="lessons" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Lessons <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <!-- ADD NEW LESSONS HERE -->
            <li><a href="lessons_install_R.html">Installing R</a></li>
            <li><a href="lessons_git.html">Getting Started with Git and GitHub</a></li>
            <li><a href="lessons_writing_functions.html">Writing Functions</a></li>
            <li><a href="lessons_loops_conditionals.html">Loops and Conditional Execution</a></li>
            <li><a href="lessons_functional_forms2.html">Functional Forms</a></li>
          </ul>
        </li>
        <!-- end lessons dropdown -->
        <!-- start references dropdown -->
        <li class="dropdown">
          <a href="references" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">References <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <!-- ADD NEW REFERENCE PAGES HERE -->
            <li><a href="writing-advice.html">Writing Advice</a></li>
            <li><a href="latex4research.html">LaTeX</a></li>
            <li><a href="word4research.html">Word for Research</a></li>
            <li><a href="Rmarkdown.html">R Markdown</a></li>
            <li><a href="stata_to_R.html">Moving from Stata to R</a></li>
            <li><a href="submitting-assign.html"> Submitting Assignments</a></li>
          </ul>
        </li>
        <!-- end references dropdown -->
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/UW-POLS503/pols_503_sp16/issues">Report Bug</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->


<div class="fluid-row" id="header">


<h1 class="title">Programming in R</h1>

</div>


<div id="learning-objectives" class="section level2">
<h2>Learning Objectives</h2>
<ul>
<li>You will learn some basic R programming to make code less redundant and more efficient</li>
<li>You will learn how to write and use R functions</li>
<li>You will learn how to write and use <code>for</code> loops</li>
<li>You will learn how to write and use conditional execution (<code>if</code>-<code>else</code> statements)</li>
</ul>
</div>
<div id="required-packages-and-datasets" class="section level2">
<h2>Required Packages and Datasets</h2>
<p>Make sure you can load all these packages and dataset before starting the module</p>
<pre class="r"><code>library(dplyr)
library(uwpols501)
data(turnout)</code></pre>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>Why should we use functions? Well, donâ€™t take it from me, take it from <a href="http://r4ds.had.co.nz/functions.html">Grolemund &amp; Wickham (2016)</a>:</p>
<p><em>Writing a function has three big advantages over using copy-and-paste:</em></p>
<ol style="list-style-type: decimal">
<li><em>You drastically reduce the chances of making incidental mistakes when you copy and paste.</em></li>
<li><em>As requirements change, you only need to update code in one place, instead of many.</em></li>
<li><em>You can give a function an evocative name that makes your code easier to understand.</em></li>
</ol>
<p>Writing a function step by step:</p>
<ol style="list-style-type: decimal">
<li>Specify a function name</li>
<li>Use the <code>function()</code> command</li>
<li>Specify inside the <code>function()</code> command the arguments that the functions takes</li>
<li>Write what the function does between the curly brackets <code>{ }</code> (Function names should be verbs, and arguments should be nouns)</li>
</ol>
<p>A function has the following skeleton:</p>
<pre class="r"><code>function_name &lt;- function(argument1, argument2, ...) {
  # do_something with the arguments
  output &lt;- argument1 + argument2
  return(output)
}</code></pre>
<p>A short/silly example:</p>
<pre class="r"><code>say_hi &lt;- function(name) {
  full_statement &lt;- paste0(&quot;Hi! My name is &quot;, name)
  return(full_statement)
}
full_statement &lt;- say_hi(&quot;Andreu&quot;)
full_statement</code></pre>
<pre><code>## [1] &quot;Hi! My name is Andreu&quot;</code></pre>
<p>A real example:</p>
<p>For the final project last quarter, one of your classmates needed to retrieve the first digit of all numbers for several numeric variables. So the person had to write the same code multiple times. Letâ€™s now write a function that would simplify that code.</p>
<pre class="r"><code>get_first_digit &lt;- function(variable) {
  num_digits &lt;- nchar(variable)
  var_first_num &lt;- variable %/% (10 ^ (nchar(variable) - 1))
  return(var_first_num)
}</code></pre>
<p>Now apply the function <code>get_first_digit()</code> that we just created to the variables <code>age</code> and <code>educate</code> of the <code>turnout</code> dataset.</p>
<pre class="r"><code>turnout$age_new &lt;- get_first_digit(turnout$age)
turnout$educate_new &lt;- get_first_digit(turnout$educate)</code></pre>
<div id="challenge-1" class="panel panel-primary">
<div class="panel-heading">
<h3 class="panel-title">
Challenge
</h3>
</div>
<div class="panel-body">
<p>Look through some of your previous code from other classes and projects, and write a function to reduce redundancy (10 min.)</p>
</div>
</div>
</div>
<div id="for-loops" class="section level2">
<h2>For Loops</h2>
<p>We use <code>for</code> loops to iterate through multiple elements of a list, variable, etc., and do <strong>something</strong> with those elements.</p>
<p>A <code>for</code> loop has the following skeleton:</p>
<pre class="r"><code>for (each_element in here) { # Try to use meaningful names for the
  # do something             #   &quot;each_element&quot; object
  print(each_element + 1)
}</code></pre>
<p>A short/silly example:</p>
<pre class="r"><code>list_numbers &lt;- sample(x = 1:100, size = 10, replace = FALSE) # sample() function
for (number in list_numbers) {
  print(paste0(&quot;2 times &quot;, number, &quot; is &quot;, number * 2))
}</code></pre>
<pre><code>## [1] &quot;2 times 26 is 52&quot;
## [1] &quot;2 times 55 is 110&quot;
## [1] &quot;2 times 6 is 12&quot;
## [1] &quot;2 times 46 is 92&quot;
## [1] &quot;2 times 47 is 94&quot;
## [1] &quot;2 times 78 is 156&quot;
## [1] &quot;2 times 35 is 70&quot;
## [1] &quot;2 times 51 is 102&quot;
## [1] &quot;2 times 16 is 32&quot;
## [1] &quot;2 times 57 is 114&quot;</code></pre>
<p>A real example:</p>
<p>Going back to the <code>turnout</code> dataset. Imagine that we want to estimate the same linear model for different groups of people based on their age: if theyâ€™re in their 20s, 30s, etc. We can do that using a <code>for</code> loop and the <code>age_new</code> variable we just created. We want to estimate the following linear model:</p>
<pre class="r"><code>model_formula &lt;- vote ~  educate + income</code></pre>
<p>We first create an empty <code>results</code> dataset that weâ€™ll fill with the coefficients and SEs of each model run.</p>
<pre class="r"><code>groups &lt;- sort(unique(turnout$age_new))
results &lt;- data.frame(age_new = groups,
                      edu_coef = rep(NA, length(groups)),
                      edu_se = rep(NA, length(groups)),
                      inc_coef = rep(NA, length(groups)),
                      inc_se = rep(NA, length(groups)))</code></pre>
<p>Now we estimate the model for each age group and we store the coefficients and SEs for each covariate in the <code>results</code> dataset.</p>
<pre class="r"><code>for (i in 1:length(groups)) {
  gr &lt;- groups[i]
  sub_data &lt;- filter(turnout, age_new == gr)
  gr_model &lt;- lm(model_formula, data = sub_data)
  results$edu_coef[i] &lt;- coef(gr_model)[2]
  results$edu_se[i] &lt;- sqrt(diag(vcov(gr_model)))[2]
  results$inc_coef[i] &lt;- coef(gr_model)[3]
  results$inc_se[i] &lt;- sqrt(diag(vcov(gr_model)))[3]
}
results</code></pre>
<pre><code>##   age_new    edu_coef      edu_se   inc_coef      inc_se
## 1       1 0.140059313 0.082778700 0.01274892 0.039715750
## 2       2 0.063378607 0.009439463 0.02507891 0.010440232
## 3       3 0.021207718 0.007576099 0.02046039 0.008160295
## 4       4 0.019001688 0.006927712 0.02376950 0.006841288
## 5       5 0.007035486 0.008418543 0.02497013 0.009194134
## 6       6 0.031704074 0.007440671 0.01638239 0.010026787
## 7       7 0.034649523 0.007606808 0.02289379 0.021474441
## 8       8 0.040120030 0.017361915 0.03912396 0.039786221
## 9       9 0.000000000         NaN 0.00000000         NaN</code></pre>
<div id="challenge-2" class="panel panel-primary">
<div class="panel-heading">
<h3 class="panel-title">
Challenge
</h3>
</div>
<div class="panel-body">
<p>Take a look at the <code>results</code> dataset. Is there something wrong? Why? What happened? Talk to your classmates and try to figure it out (5 min.).</p>
</div>
</div>
</div>
<div id="conditional-execution-if-and-else-statements" class="section level2">
<h2>Conditional Execution: if and else statements</h2>
<p>Sometimes we only want to execute certain code if the data fulfills some conditions. To do that we use <code>if</code> and <code>else</code> statements.</p>
<p>How <code>if</code> and <code>else</code> statements look like:</p>
<pre class="r"><code>if (this) {
  # do that
} else if (that) {
  # do something else
} else {
  #
}</code></pre>
<p><strong>This</strong> and <strong>that</strong> in the previous chunk of code are boolean tests: code that returns TRUE/FALSE when the computer executes it. Some examples of boolean tests:</p>
<pre class="r"><code>10 == 2</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>10 %in% c(2, 5, 13, 20, 10)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>10 == 2 &amp; 10 %in% c(2, 5, 13, 20, 10)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>10 == 2 | 10 %in% c(2, 5, 13, 20, 10)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>A short/silly example:</p>
<pre class="r"><code>some_numbers &lt;- c(1, 4, 6, 10,12, 16, 45, 88, 102)
for (number in some_numbers) {
  if (number &lt; 10) {
    print(paste0(number, &quot; is smaller than 10&quot;))
  } else if (number &lt; 50) {
    print(paste0(number, &quot; is smaller than 50 but greater or equal to 10&quot;))
  } else {
    print(paste0(number, &quot; is greater than 50&quot;))
  }
}</code></pre>
<pre><code>## [1] &quot;1 is smaller than 10&quot;
## [1] &quot;4 is smaller than 10&quot;
## [1] &quot;6 is smaller than 10&quot;
## [1] &quot;10 is smaller than 50 but greater or equal to 10&quot;
## [1] &quot;12 is smaller than 50 but greater or equal to 10&quot;
## [1] &quot;16 is smaller than 50 but greater or equal to 10&quot;
## [1] &quot;45 is smaller than 50 but greater or equal to 10&quot;
## [1] &quot;88 is greater than 50&quot;
## [1] &quot;102 is greater than 50&quot;</code></pre>
<p>Real example:</p>
<p>In the previous code where we estimated the same model for different groups of age we run into an issue with the last group: people in their 90s.</p>
<pre class="r"><code>table(turnout$age_new)</code></pre>
<pre><code>## 
##   1   2   3   4   5   6   7   8   9 
##  26 431 433 347 277 256 158  69   3</code></pre>
<p>Since there are only 3 people who are in their 90s we run out of degrees of freedom. Remember that df = #observations - 1 - #variables_in_the_model. Letâ€™s adapt that code so that we only estimate the model in those cases we have enough degrees of freedom and prints a messages when thatâ€™s not the case.</p>
<pre class="r"><code>results2 &lt;- data.frame(age_new = groups,
                      edu_coef = rep(NA, length(groups)),
                      edu_se = rep(NA, length(groups)),
                      inc_coef = rep(NA, length(groups)),
                      inc_se = rep(NA, length(groups)))
for (i in 1:length(groups)) {
  gr &lt;- groups[i]
  sub_data &lt;- filter(turnout, age_new == gr)
  gr_model &lt;- lm(model_formula, data = sub_data)
  if (gr_model$df &gt; 1) {
    results2$edu_coef[i] &lt;- coef(gr_model)[2]
    results2$edu_se[i] &lt;- sqrt(diag(vcov(gr_model)))[2]
    results2$inc_coef[i] &lt;- coef(gr_model)[3]
    results2$inc_se[i] &lt;- sqrt(diag(vcov(gr_model)))[3]
  } else {
    print(paste0(&quot;Not enough obs. to estimate the model for gr == &quot;, gr))
  }
}</code></pre>
<pre><code>## [1] &quot;Not enough obs. to estimate the model for gr == 9&quot;</code></pre>
<pre class="r"><code>results2</code></pre>
<pre><code>##   age_new    edu_coef      edu_se   inc_coef      inc_se
## 1       1 0.140059313 0.082778700 0.01274892 0.039715750
## 2       2 0.063378607 0.009439463 0.02507891 0.010440232
## 3       3 0.021207718 0.007576099 0.02046039 0.008160295
## 4       4 0.019001688 0.006927712 0.02376950 0.006841288
## 5       5 0.007035486 0.008418543 0.02497013 0.009194134
## 6       6 0.031704074 0.007440671 0.01638239 0.010026787
## 7       7 0.034649523 0.007606808 0.02289379 0.021474441
## 8       8 0.040120030 0.017361915 0.03912396 0.039786221
## 9       9          NA          NA         NA          NA</code></pre>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
